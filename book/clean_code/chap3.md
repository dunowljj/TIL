# CleanCode

#

# 3장 함수

-

### 어떤 프로그램이든 가장 기본적인 단위가 함수다.

### 작게 만들어라!

- 첫째 규칙은 '작게!'. 둘째 규칙은 '더 작게!'다.

#블록과 들여쓰기

- if문/else문/while문 등에 들어가는 블록은 한 줄이어야 한다.
- 중첩 구조가 생길만큼 함수가 커져서는 안된다. 함수에서 들여쓰기 수준은 1단이나 2단을 넘어서면 안된다.

### 한 가지만 해라!

- 함수는 한 가지를 해야 한다. 그 한 가지를 잘 해야 한다. 그 한 가지만을 해야 한다.
- 추상화 수준이 하나
    - 의미를 유지하면서 줄일 수 있는가?
    - 의미 있는 이름으로 다른 함수를 추출할 수 있는가? -> 여러 작업하는 셈
    - includeSetupsAndTeardownsIfTestPate 라는 함수는 다르게 표현할 뿐 이전과 추상화 수준은 같다.

### 함수 추상화 수준은 하나로

- 함수 내에 추상화 수준을 섞으면 코드를 읽는 사람이 헷갈린다. -> 특정 표현이 근본 개념인지 세부 사항인지 구분하기 어려운 탓
- 근본 개념과 세부사항을 뒤섞기 시작하면 사람들이 함수에 세부사항을 점점 더 추가한다.

위에서 아래로 코드 읽기 : **내려가기** 규칙

- 내려가기 규칙 :  한 함수 다음에는 추상화 수준이 한 단계 낮은 함수가 온다.

### Switch 문(47p)

#문제점

- 함수가 길다. 직원 추가 시 더 길어짐
- '한 가지' 작업만 수행하지 않는다.
- SRP(Single Responsibility Principle) 위반
- OCP(Open Closed Principle) 위반

#해결

- 추상팩토리 안에 스위치문 꽁꽁 숨기기
- 불가피한 경우도 있긴 함

### 서술적인 이름을 사용하라

- 좋은 이름을 코드 재구성
- 짧고 어려운 이름보다 길고 서술적인 이름이 낫다.

### 함수 인수

- 이상적인 인수 개수는 0개 이다.
- 1, 2, 3(삼항 가능하면 피하기), 4개 이상은 특별한 이유가 필요하며, 있어도 안써야함
- 함수와 인수사이 추상화 수준이 다른 경우
- 인수를 넣으면 해당 내용을 읽을때마다 의미를 확인해야하고, 읽는 사람이 현시점에서 중요하지 않은 세부사항을 알아야 함
- 최선은 0개, 차선은 1개

#많이 쓰는 단항 형식

- 1개 넘기는 가장 흔한 경우
    - 인수에게 질문을 던지는 경우 -> boolean fileExists("MyFile")
    - 인수를 뭔가로 변환해 결과를 반환하는 경우 -> InpuStream fileOpen("MyFile")
- 드물지만 유용한 단항 함수 형식인 이벤트 함수
    - 입력 인수만 있고 출력 인수는 없다.
    - 프로그램은 함수 호출을 이벤트로 해석해 입력 인수로 시스템 상태를 바꾼다. -> passwordAttemptFailedNtimes(int attempts)
    - 이벤트라는 사실이 코드에 명확하게 드러나야 함
- 위 내용이 아니면 단항 함수를 가급적 피한다.
    - 변환 함수에서 출력 인수를 사용하면 혼란을 일으킨다.
    - 입력 인수를 변환하는 함수라면 변환값으로 돌려준다.

#플래그 인수

- 플래그 인수는 추하다. 부울 값을 넘기는 자체가 한꺼번에 여러 가지를 처리한다고 대놓고 공표하는 셈

#이항함수

- 인수가 2개인 함수는 인수가 1개인 함수보다 이해하기 어렵다
    - writeFile(name) / wirteFile(outputStream, name)
        - 둘 다 의미는 명백하지만 전자가 쉽게 읽히고 더 빨리 이해.
        - 후자는 인수를 무시해야 한다는 사실을 깨닫는 시간이 필요
- 적절한 경우
    - Point p = new Point(0,0)
        - 한 값을 표현하는 두 요소
        - **자연적으로 순서**가 정해짐
- 단항 함수로 바꾸기 위해 노력하기
    - 해결책
        - 1. outputStream.writeField(name)
        - 2. FieldWriter 클래스에 outputStream 받기

#삼항함수

- 2개보다 이해하기 어렵다.
- assertEquals(message, expected, actural)
    - 왜 exepcted 가 앞에 있지 않지?
    - massage 무시....

#인수객체

- 인수가 2-3개 필요하다면 일부를 독자적인 클래스 변수로 선언할 가능성을 짚어본다.
    - Cirecle makeCircle(double x, double y, double radius);
    - Cirecle makeCircle(Point center, double radius);
        - 눈속임 같지만 변수를 묶어 넘기려면 이름을 붙여야 함. 결국은 개념을 표현

#인수목록

- 때로는 인수 개수가 가변적임 함수도 필요하다.
    - String.format("%s worked %.2f" hours.", name, hours);
        - 사실상 이항 함수
        - 선언부를 보면 분명히 드러남
- 가변 인수를 취하는 모든 함수에 같은 원리가 적용
- 하지만 이를 넘어서는 인수를 사용 시 문제가 됨

#동사와 키워드

- 단항 함수는 함수와 인수가 동사/명사 쌍을 이루기
    - wirte(name), writeField(name) 후자가 더 좋긴 함
- 함수에 키워드를 추가
    - assertEquals보다 assertExpectedEqualsActual(expected, actual)과 같이 쓰면 인수 순서를 기억할 필요가 없다.

### 부수 효과를 일으키지 마라!

- checkPassword 함수 안에 세션 초기화가 있는 경우 이름만 보고 사용했다가 의도치 않은 초기화를 할 가능성이 생긴다.

#출력 인수

- 일반적으로 출력인수를 피해야 한다.
- 객체지향언어에서 this가 있기 때문에 출력인수 사용할 필요 거의 없음.
    - appendFooter(s) ;  --> report.appendFooter()와 같이 호출하는게 좋다.

### 명령과 조회를 분리하라!

- 무언가를 수행하거나 무언가에 답하거나 둘 중 하나만 해야 한다.
    - boolean set(String attribut, String value) => 애초에 set을 동사로 생각했지만, if문 안에 넣으면 set이 형용사처럼 느껴진다.

### 오류 코드보다 예외를 사용하라!

- 명령 함수에서 오류 코드를 반환하는 방식은 명령/조회 분리 규칙을 미묘하게 위반한다.
    - if(deletePage(page) == E_OK)  = > 여러 단계로 중첩되는 코드 야기
    - 오류 코드 대신 예외 사용 시 오류 처리 코드가 원래 코드에서 분리되어 깔끔해짐

#Try/Catch 블록 뽑아내기

- try/catch 블록은 원래 추하다. 코드 구조에 혼란을 일으키며, 정상 동작과 오류 처리 동작을 뒤섞는다.
    - 별도로 뽑아내는게 좋다.
- 정상 동작과 오류 처리 동작을 분리하면 코드를 이해하고 수정하기 쉬워진다.

#오류 처리도 한 가지 작업이다.

- 오류도 '한 가지' 작업에 속한다.
- 함수는 오류만 처리해야 마땅하다.

#[Error.java](http://Error.java) 의존성 자석

- 오류 코드를 반환한다 -> 클래스든, 열거형 변수든 어디선가 오류 코드를 정의
- 의존성 자석 -> 결국 import해서 사용, 해당 enum을 사용하는 클래스 전부를 다시 컴파일하고 다시 배치해야 한다.

###  반복하지 마라!

- 중복은 소프트웨어에서 모든 악의 근원
- 고칠 곳이 많아짐

### 구조적 프로그래밍

- 입구와 출구가 하나(함수는 return문이 하나)
    - 함수가 작다면 위 규칙은 별 이익이 없음
    - goto는 큰 함수에서만 의미, 작은 함수에서는 피해야한다.

### 함수를 어떻게 짜죠?

- 처음에는 길고 복잡함. 하지만 서투른 코드를 빠짐없이 테스트하는 단위 테스크 케이스도 만듦
- 그 다음 코드를 다듬고, 함수를 만들고, 이름을 바꾸고, 중복을 제거. 단위 테스트는 항상 통과

### 결론

- 대가 프로그래머는 시스템을 (구현할) 프로그램이 아니라 (풀어갈) 이야기로 여긴다. 시스템에서 발생하는 모든 동작을 설명하는 함수 계층이 그 언어에 속한다.
- 하지만 진짜 목표는 **시스템이라는 이야기를 풀어가는데** 있다는 사실을 명심